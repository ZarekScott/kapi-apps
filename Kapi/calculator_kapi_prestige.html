<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kapi â€” Deal Calculator Â· Prestige</title>
  <meta name="color-scheme" content="dark light" />
  <style>
    /* ===== Brand: Prestige theme (minimal, refined, subtle neon) ===== */
    :root{
      --bg:#0a0f17;
      --panel:#0e1523;
      --panel-2:#0b1220;
      --ink:#e8eef6;
      --muted:#9ca9bd;
      --border:#1a2538;
      --accent:#10b981; /* Emerald prestige */
      --accent-weak: rgba(16,185,129,.16);
      --good:#10b981;
      --bad:#ef4444;
      --warning:#f59e0b;
      --shadow: 0 0 0px var(--accent), 0 0 8px var(--accent), 0 0 18px var(--accent);
      --radius:16px;
    }
    [data-theme="light"]{
      --bg:#f6f8fb;
      --panel:#ffffff;
      --panel-2:#f3f5f8;
      --ink:#0f172a;
      --muted:#51607a;
      --border:#e5ebf2;
      --shadow: 0 0 0px var(--accent), 0 0 10px var(--accent), 0 0 22px var(--accent);
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .wrap{max-width:1200px;margin:0 auto;padding:24px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
    .brand{display:flex;align-items:center;gap:12px}
    .k{width:44px;height:44px;border-radius:14px;background:
       radial-gradient(40% 40% at 70% 30%, var(--accent-weak), transparent 60%),
       linear-gradient(140deg, transparent 40%, var(--accent-weak));
       border:1px solid var(--accent);box-shadow:var(--shadow);position:relative;overflow:hidden}
    .k::before{content:"";position:absolute;inset:9px 12px;border:3px solid var(--accent);border-left:0;border-top:0;border-bottom-right-radius:10px;filter:drop-shadow(0 0 6px var(--accent));}
    .logo{font-weight:900;letter-spacing:.3px}
    .controls{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .btn,.chip{border:1px solid var(--border);border-radius:12px;background:transparent;color:var(--ink);padding:8px 12px;font-weight:700;cursor:pointer}
    .btn.primary{background:var(--accent);color:#04130e;border-color:transparent;box-shadow:var(--shadow)}
    a{color:var(--accent)}
    .grid{display:grid;grid-template-columns:1.15fr .85fr;gap:16px}
    @media (max-width: 980px){ .grid{grid-template-columns:1fr} }
    .panel{background:linear-gradient(180deg,var(--panel),var(--panel-2));border:1px solid var(--border);border-radius:var(--radius);padding:16px}
    h2{margin:0 0 10px 0}
    .muted{color:var(--muted)}
    .hr{height:1px;background:var(--border);margin:10px 0}
    .row{display:grid;grid-template-columns:repeat(12,1fr);gap:10px}
    .field{display:flex;flex-direction:column;gap:6px;grid-column: span 6}
    .field.sm{grid-column: span 3}
    .field.md{grid-column: span 4}
    .field.lg{grid-column: span 8}
    .field.full{grid-column: 1/-1}
    label{font-size:12px;color:var(--muted);display:flex;align-items:center;gap:8px}
    input, select{padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:transparent;color:inherit}
    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button{-webkit-appearance:none;margin:0}
    .lamp{display:flex;align-items:center;gap:10px}
    .dot{width:14px;height:14px;border-radius:999px;border:2px solid var(--border)}
    .dot.good{background:var(--good);box-shadow:0 0 10px var(--good), 0 0 18px var(--good)}
    .dot.bad{background:var(--bad);box-shadow:0 0 10px var(--bad), 0 0 18px var(--bad)}
    .dot.warn{background:var(--warning);box-shadow:0 0 10px var(--warning), 0 0 18px var(--warning)}
    .kpis{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin-bottom:12px}
    @media (max-width:1000px){ .kpis{grid-template-columns:repeat(2,1fr)} }
    .kpi{background:var(--panel-2);border:1px solid var(--border);border-radius:14px;padding:12px}
    .kpi .label{font-size:12px;color:var(--muted)}
    .kpi .value{font-size:22px;font-weight:900}
    .badge{display:inline-flex;gap:6px;align-items:center;border:1px solid var(--border);border-radius:999px;padding:4px 8px;background:var(--panel-2);font-size:12px}
    .legend{display:flex;gap:8px;flex-wrap:wrap}
    .sw{width:26px;height:26px;border-radius:8px;border:1px solid var(--border);cursor:pointer}
    .sw.emerald{background:#10b981}.sw.cyan{background:#22d3ee}.sw.fuchsia{background:#e879f9}.sw.purple{background:#a78bfa}.sw.amber{background:#f59e0b}
    .help{display:none;font-size:12px;color:var(--muted);background:rgba(2,12,20,.32);border:1px dashed var(--border);padding:8px;border-radius:10px}
    .help.on{display:block}
    .pill{display:inline-flex;gap:8px;align-items:center;padding:6px 10px;border:1px dashed var(--border);border-radius:999px;background:rgba(16,185,129,.12)}
    .flag{display:inline-flex;gap:6px;align-items:center;border:1px solid var(--border);border-radius:10px;padding:6px 10px}
  </style>
</head>
<body>
  <div class="wrap">
    <!-- Header -->
    <header>
      <div class="brand">
        <div class="k" aria-hidden="true"></div>
        <div>
          <div class="logo">Kapi Deal Calculator</div>
          <div class="muted">Prestige edition â€” refined layout with investorâ€‘grade metrics</div>
        </div>
      </div>
      <div class="controls">
        <span class="badge">Theme</span>
        <button class="chip" id="themeToggle" aria-label="Toggle theme">ðŸŒ™</button>
        <span class="badge">Accent</span>
        <div class="legend" id="accentList">
          <div class="sw emerald" data-accent="#10b981" title="Emerald"></div>
          <div class="sw cyan" data-accent="#22d3ee" title="Cyan"></div>
          <div class="sw fuchsia" data-accent="#e879f9" title="Fuchsia"></div>
          <div class="sw purple" data-accent="#a78bfa" title="Purple"></div>
          <div class="sw amber" data-accent="#f59e0b" title="Amber"></div>
        </div>
        <label class="badge"><input type="checkbox" id="helpMode" style="accent-color:var(--accent)"> Help mode</label>
      </div>
    </header>

    <!-- KPIs -->
    <section class="kpis" id="kpis">
      <div class="kpi"><div class="label">NOI (annual)</div><div class="value" id="kpiNOI">â€”</div></div>
      <div class="kpi"><div class="label">Cash Flow (annual)</div><div class="value" id="kpiCF">â€”</div></div>
      <div class="kpi"><div class="label">DSCR</div><div class="value" id="kpiDSCR">â€”</div></div>
      <div class="kpi"><div class="label">Cap Rate</div><div class="value" id="kpiCap">â€”</div></div>
      <div class="kpi"><div class="label">Cashâ€‘onâ€‘Cash</div><div class="value" id="kpiCoC">â€”</div></div>
    </section>

    <div class="grid">
      <!-- Left: Inputs -->
      <section class="panel">
        <div style="display:flex;align-items:center;justify-content:space-between">
          <h2>Deal Basics</h2>
          <div class="lamp"><span id="signalDot" class="dot"></span><span id="signalText" class="muted">â€”</span></div>
        </div>

        <div class="row">
          <div class="field md">
            <label>Property type <span class="pill">MF Â· SFH Â· Retail Â· Office Â· Industrial</span></label>
            <select id="propType">
              <option>Multifamily</option><option>Single-family</option><option>Retail</option><option>Office</option><option>Industrial</option>
            </select>
            <div class="help" data-help="propType">Sets typical defaults for vacancy & expenses.</div>
          </div>
          <div class="field md">
            <label>Lease type <span class="pill">NNN Â· MG Â· Gross</span></label>
            <select id="leaseType"><option>NNN</option><option>Modified Gross</option><option>Gross</option></select>
            <div class="help" data-help="leaseType">NNN: tenant pays most opex; MG/Gross: landlord pays some/all.</div>
          </div>
          <div class="field md">
            <label>Units</label>
            <input id="units" type="number" min="0" step="1" value="6">
            <div class="help">Used for price/door metric (if &gt; 0).</div>
          </div>
          <div class="field md">
            <label>Square footage (SF)</label>
            <input id="sqft" type="number" min="0" step="50" value="5200">
            <div class="help">Used for price/SF metric (if &gt; 0).</div>
          </div>

          <div class="field md">
            <label>Purchase price ($)</label>
            <input id="price" type="number" min="0" step="1000" value="525000">
            <div class="help" data-help="price">Contract price (before closing & renovations).</div>
          </div>
          <div class="field md">
            <label>Down payment (%)</label>
            <input id="downPct" type="number" min="0" max="100" step="0.5" value="25">
          </div>
          <div class="field md">
            <label>Closing costs (%)</label>
            <input id="closePct" type="number" min="0" step="0.1" value="3">
          </div>
          <div class="field md">
            <label>Upfront CapEx / Renovation ($)</label>
            <input id="reno" type="number" min="0" step="500" value="15000">
          </div>
        </div>

        <div class="hr"></div>
        <h2>Income</h2>
        <div class="row">
          <div class="field md">
            <label>Monthly rent ($)</label>
            <input id="rent" type="number" min="0" step="50" value="6200">
            <div class="help">Total scheduled rent per month (all units/tenants).</div>
          </div>
          <div class="field md">
            <label>Other income / month ($)</label>
            <input id="otherInc" type="number" min="0" step="10" value="250">
          </div>
          <div class="field md">
            <label>Vacancy (%)</label>
            <input id="vacancy" type="number" min="0" max="100" step="0.5" value="6">
          </div>
          <div class="field md">
            <label>GRM (info)</label>
            <input id="grmDisplay" disabled value="â€”">
            <div class="help">Gross Rent Multiplier = Price / (Gross Rent Annual).</div>
          </div>
        </div>

        <div class="hr"></div>
        <h2>Expenses</h2>
        <div class="row">
          <div class="field md">
            <label>Expense mode</label>
            <select id="expMode"><option>Ratio (%)</option><option>Advanced (itemized)</option></select>
            <div class="help">Use a simple ratio or itemize below.</div>
          </div>
          <div class="field md" id="expRatioBox">
            <label>Expense ratio (%)</label>
            <input id="expRatio" type="number" min="0" max="100" step="1" value="35">
          </div>
        </div>
        <div id="advWrap" style="display:none">
          <div class="row" style="margin-top:8px">
            <div class="field md"><label>Taxes / mo ($)</label><input id="taxes" type="number" min="0" step="10" value="420"></div>
            <div class="field md"><label>Insurance / mo ($)</label><input id="ins" type="number" min="0" step="10" value="190"></div>
            <div class="field md"><label>Utilities / mo ($)</label><input id="utils" type="number" min="0" step="10" value="120"></div>
            <div class="field md"><label>Repairs/CapEx reserve / mo ($)</label><input id="repairs" type="number" min="0" step="10" value="250"></div>
            <div class="field md"><label>Mgmt fee (% of EGI)</label><input id="mgmtPct" type="number" min="0" step="0.5" value="7"></div>
            <div class="field md"><label>HOA/Other / mo ($)</label><input id="hoa" type="number" min="0" step="10" value="0"></div>
          </div>
          <div class="help on">Advanced: sums itemized costs + management % of EGI.</div>
        </div>

        <div class="hr"></div>
        <h2>Financing</h2>
        <div class="row">
          <div class="field md">
            <label>Loan type</label>
            <select id="loanType"><option>Amortizing</option><option>Interest Only</option></select>
          </div>
          <div class="field md"><label>Interest rate (% APR)</label><input id="rate" type="number" min="0" step="0.05" value="6.75"></div>
          <div class="field md"><label>Term (years)</label><input id="termYears" type="number" min="1" step="1" value="30"></div>
          <div class="field md"><label>I/O period (months)</label><input id="ioMonths" type="number" min="0" step="1" value="0"></div>
        </div>

        <div class="hr"></div>
        <h2>Investor Targets</h2>
        <div class="row">
          <div class="field md"><label>Min DSCR</label><input id="targetDSCR" type="number" min="0" step="0.05" value="1.20"></div>
          <div class="field md"><label>Min Cashâ€‘onâ€‘Cash (%)</label><input id="targetCoC" type="number" min="0" step="0.5" value="8"></div>
          <div class="field md"><label>Max LTV (%)</label><input id="targetLTV" type="number" min="0" step="1" value="80"></div>
          <div class="field md"><label>&nbsp;</label><div class="flag"><span id="flagDSCR" class="muted">DSCR â€”</span></div></div>
        </div>

        <div class="hr"></div>
        <div class="row">
          <div class="field md"><label>Sample</label><button class="btn" id="btnSample">Load example</button></div>
          <div class="field md"><label>Persistence</label><button class="btn" id="btnSave">Save inputs</button></div>
          <div class="field md"><label>&nbsp;</label><button class="btn" id="btnReset">Reset</button></div>
          <div class="field md"><label>&nbsp;</label><button class="btn primary" id="btnRun">Run analysis</button></div>
        </div>
      </section>

      <!-- Right: Results -->
      <section class="panel">
        <h2>Results (Yearâ€‘1)</h2>
        <div class="hr"></div>
        <div class="row">
          <div class="field md"><label>Upfront cash invested</label><input id="upfront" disabled></div>
          <div class="field md"><label>Loan amount</label><input id="loanAmt" disabled></div>
          <div class="field md"><label>Monthly debt service</label><input id="moDebt" disabled></div>
          <div class="field md"><label>Annual debt service</label><input id="annDebt" disabled></div>

          <div class="field md"><label>Effective Gross Income (EGI)</label><input id="egi" disabled></div>
          <div class="field md"><label>Operating expenses</label><input id="opex" disabled></div>
          <div class="field md"><label>NOI</label><input id="noi" disabled></div>
          <div class="field md"><label>Cash flow</label><input id="annCF" disabled></div>

          <div class="field md"><label>DSCR</label><input id="dscr" disabled></div>
          <div class="field md"><label>Cap rate</label><input id="cap" disabled></div>
          <div class="field md"><label>Cashâ€‘onâ€‘Cash</label><input id="coc" disabled></div>
          <div class="field md"><label>Breakâ€‘even occupancy</label><input id="beOcc" disabled></div>

          <div class="field md"><label>LTV (Loan / Price)</label><input id="ltv" disabled></div>
          <div class="field md"><label>LTC (Loan / (Price+CapEx+Closing))</label><input id="ltc" disabled></div>
          <div class="field md"><label>Price / Unit</label><input id="ppu" disabled></div>
          <div class="field md"><label>Price / SF</label><input id="ppsf" disabled></div>
        </div>

        <div class="hr"></div>
        <div class="muted">This is a simplified model. Verify numbers and assumptions for your market and lender.</div>
      </section>
    </div>
  </div>

  <script>
    const $ = id => document.getElementById(id);
    const money = n => (n<0?'-':'')+'$'+Math.abs(n||0).toLocaleString(undefined,{maximumFractionDigits:0});
    const pct = n => (n!=null && isFinite(n)) ? (n*100).toFixed(2)+'%' : 'â€”';

    // Theme & Accent
    const themeToggle = $('themeToggle');
    function loadTheme(){
      const t = localStorage.getItem('kapi.theme')||'dark';
      if (t==='light') document.body.setAttribute('data-theme','light'); else document.body.removeAttribute('data-theme');
      themeToggle.textContent = t==='light'?'ðŸŒž':'ðŸŒ™';
      const a = localStorage.getItem('kapi.accent');
      if (a){ document.documentElement.style.setProperty('--accent', a);
             document.documentElement.style.setProperty('--accent-weak', a+'28'); }
    }
    themeToggle.addEventListener('click',()=>{
      const light = !document.body.hasAttribute('data-theme');
      if (light) document.body.setAttribute('data-theme','light'); else document.body.removeAttribute('data-theme');
      localStorage.setItem('kapi.theme', light?'light':'dark');
      themeToggle.textContent = light?'ðŸŒž':'ðŸŒ™';
    });
    loadTheme();
    document.querySelectorAll('#accentList .sw').forEach(s=>s.addEventListener('click',()=>{
      const a = s.dataset.accent;
      document.documentElement.style.setProperty('--accent', a);
      document.documentElement.style.setProperty('--accent-weak', a+'28');
      localStorage.setItem('kapi.accent', a);
    }));

    // Help mode
    const helpToggle = $('helpMode');
    function setHelp(on){ document.querySelectorAll('.help').forEach(h=>h.classList.toggle('on', on));
                          localStorage.setItem('kapi.help', on?'1':'0'); }
    helpToggle.addEventListener('change', e=>setHelp(e.target.checked));
    setHelp(localStorage.getItem('kapi.help')==='1'); helpToggle.checked = localStorage.getItem('kapi.help')==='1';

    // Mode switches
    const expMode = $('expMode'), advWrap = $('advWrap'), expRatioBox = $('expRatioBox');
    function updateExpMode(){ const adv = expMode.value.includes('Advanced');
      advWrap.style.display = adv?'block':'none'; expRatioBox.style.display = adv?'none':'block'; }
    expMode.addEventListener('change', updateExpMode); updateExpMode();

    // Inputs to persist
    const inputs = ['propType','leaseType','units','sqft','price','downPct','closePct','reno','rent','otherInc','vacancy','expMode','expRatio','taxes','ins','utils','repairs','mgmtPct','hoa','loanType','rate','termYears','ioMonths','targetDSCR','targetCoC','targetLTV'];
    function saveInputs(){ const data = {}; inputs.forEach(id=>data[id] = $(id).value); localStorage.setItem('kapi.prestige.inputs', JSON.stringify(data)); }
    function loadInputs(){ try{
      const data = JSON.parse(localStorage.getItem('kapi.prestige.inputs')||'{}');
      inputs.forEach(id=>{ if (data[id]!==undefined) $(id).value = data[id]; });
      updateExpMode();
    }catch{} }
    $('btnSave').addEventListener('click', ()=>{ saveInputs(); alert('Saved âœ“'); });
    $('btnReset').addEventListener('click', ()=>{ localStorage.removeItem('kapi.prestige.inputs'); location.reload(); });

    $('btnSample').addEventListener('click', ()=>{
      $('propType').value='Multifamily';
      $('leaseType').value='Modified Gross';
      $('units').value=6; $('sqft').value=5200;
      $('price').value=525000; $('downPct').value=25; $('closePct').value=3; $('reno').value=15000;
      $('rent').value=6200; $('otherInc').value=250; $('vacancy').value=6;
      $('expMode').value='Advanced (itemized)'; updateExpMode();
      $('taxes').value=420; $('ins').value=190; $('utils').value=120; $('repairs').value=250; $('mgmtPct').value=7; $('hoa').value=0;
      $('loanType').value='Amortizing'; $('rate').value=6.75; $('termYears').value=30; $('ioMonths').value=0;
      $('targetDSCR').value=1.20; $('targetCoC').value=8; $('targetLTV').value=80;
    });

    // Math
    function amortPayment(P, annualRate, years){
      const r = (annualRate/100)/12, n = years*12;
      if (r===0) return P/n;
      const m = r*Math.pow(1+r,n)/(Math.pow(1+r,n)-1);
      return P*m;
    }

    function analyze(){
      const price = +$('price').value;
      const downPct = +$('downPct').value/100;
      const closePct = +$('closePct').value/100;
      const reno = +$('reno').value;
      const units = +$('units').value||0;
      const sqft = +$('sqft').value||0;

      const loanType = $('loanType').value;
      const rate = +$('rate').value;
      const years = +$('termYears').value;
      const ioMonths = +$('ioMonths').value;

      const rent = +$('rent').value;
      const otherInc = +$('otherInc').value;
      const vacancy = +$('vacancy').value/100;

      const expModeVal = $('expMode').value;
      const expRatio = +$('expRatio').value/100;
      const taxes = +$('taxes').value, ins = +$('ins').value, utils = +$('utils').value, repairs = +$('repairs').value, mgmtPct = +$('mgmtPct').value/100, hoa = +$('hoa').value;

      const targetDSCR = +$('targetDSCR').value;
      const targetCoC = +$('targetCoC').value/100;
      const targetLTV = +$('targetLTV').value/100;

      // Capital stack
      const down = price*downPct;
      const closing = price*closePct;
      const loan = Math.max(0, price - down);
      const moDebt = (loanType==='Interest Only') ? loan*(rate/100)/12 : amortPayment(loan, rate, years);
      const annDebt = moDebt*12;

      // Income
      const sgi = rent*12 + otherInc*12;
      const vacLoss = sgi*vacancy;
      const egi = sgi - vacLoss;

      // Expenses
      let opexAnnual;
      if (expModeVal.startsWith('Ratio')){
        opexAnnual = egi*expRatio;
      } else {
        const mgmt = egi*mgmtPct;
        opexAnnual = (taxes+ins+utils+repairs+hoa)*12 + mgmt;
      }

      const noi = egi - opexAnnual;
      const annCF = noi - annDebt;

      const dscr = annDebt>0 ? (noi/annDebt) : null;
      const cap = price>0 ? (noi/price) : null;

      const upfront = down + closing + reno;
      const coc = upfront>0 ? (annCF/upfront) : null;

      const beOcc = Math.max(0, Math.min(1, (opexAnnual + annDebt - (otherInc*12)) / Math.max(1, rent*12)));
      const ltv = price>0 ? (loan/price) : null;
      const ltc = (price+reno+closing)>0 ? (loan/(price+reno+closing)) : null;
      const grm = (rent*12)>0 ? (price/(rent*12)) : null;
      const ppu = (units>0) ? (price/units) : null;
      const ppsf = (sqft>0) ? (price/sqft) : null;

      // Update KPI cards
      $('kpiNOI').textContent = money(noi);
      $('kpiCF').textContent = money(annCF);
      $('kpiDSCR').textContent = dscr? dscr.toFixed(2) : 'â€”';
      $('kpiCap').textContent = cap? (cap*100).toFixed(2)+'%' : 'â€”';
      $('kpiCoC').textContent = coc? (coc*100).toFixed(2)+'%' : 'â€”';

      // Update results
      $('upfront').value = money(upfront);
      $('loanAmt').value = money(loan);
      $('moDebt').value = money(moDebt);
      $('annDebt').value = money(annDebt);
      $('egi').value = money(egi);
      $('opex').value = money(opexAnnual);
      $('noi').value = money(noi);
      $('annCF').value = money(annCF);
      $('dscr').value = dscr? dscr.toFixed(2) : 'â€”';
      $('cap').value = cap? (cap*100).toFixed(2)+'%' : 'â€”';
      $('coc').value = coc? (coc*100).toFixed(2)+'%' : 'â€”';
      $('beOcc').value = (beOcc*100).toFixed(1)+'%';
      $('ltv').value = ltv!=null ? (ltv*100).toFixed(1)+'%' : 'â€”';
      $('ltc').value = ltc!=null ? (ltc*100).toFixed(1)+'%' : 'â€”';
      $('ppu').value = ppu!=null ? '$'+ppu.toLocaleString(undefined,{maximumFractionDigits:0}) : 'â€”';
      $('ppsf').value = ppsf!=null ? '$'+ppsf.toLocaleString(undefined,{maximumFractionDigits:2}) : 'â€”';
      $('grmDisplay').value = grm!=null ? grm.toFixed(2) : 'â€”';

      // Signal
      const good = (noi/12 - moDebt) >= 0;
      const dot = $('signalDot'); const txt = $('signalText');
      dot.className = 'dot ' + (good? 'good' : 'bad');
      txt.textContent = good ? 'Cashâ€‘flow positive' : 'Not cashâ€‘flowing';

      // Targets pass/fail
      const dscrPass = !dscr || dscr >= targetDSCR;
      const cocPass = !coc || coc >= targetCoC;
      const ltvPass = !ltv || ltv <= targetLTV;
      const allPass = dscrPass && cocPass && ltvPass && good;

      $('flagDSCR').textContent = `DSCR ${dscr? dscr.toFixed(2):'â€”'} â€¢ CoC ${coc? (coc*100).toFixed(1)+'%':'â€”'} â€¢ LTV ${ltv? (ltv*100).toFixed(1)+'%':'â€”'}`;
      $('flagDSCR').style.color = allPass ? 'var(--good)' : (dscrPass && ltvPass ? 'var(--ink)' : 'var(--bad)');

      // Persist
      saveInputs();
    }

    // Hints by type/lease
    function applyHints(){
      const type = $('propType').value, lease = $('leaseType').value;
      if (lease==='NNN'){
        if ($('expMode').value.startsWith('Ratio')) $('expRatio').value = 20;
        $('mgmtPct').value = 5; $('utils').value = 0;
      } else if (lease==='Modified Gross'){
        if ($('expMode').value.startsWith('Ratio')) $('expRatio').value = (type==='Retail'||type==='Office')? 28 : 35;
        $('mgmtPct').value = 7;
      } else {
        if ($('expMode').value.startsWith('Ratio')) $('expRatio').value = (type==='Single-family')? 25 : 40;
        $('mgmtPct').value = 8;
      }
      if (type==='Single-family') $('vacancy').value = 4;
      if (type==='Multifamily') $('vacancy').value = 6;
      if (type==='Retail'||type==='Office') $('vacancy').value = 8;
      if (type==='Industrial') $('vacancy').value = 7;
    }
    $('propType').addEventListener('change', applyHints);
    $('leaseType').addEventListener('change', applyHints);

    // Init
    function init(){
      const last = localStorage.getItem('kapi.prestige.inputs');
      if (last) loadInputs();
      applyHints();
      analyze();
      document.querySelectorAll('input,select').forEach(el=>el.addEventListener('change', e=>{
        if (['price','rent','otherInc','expRatio','downPct','closePct','reno','rate','termYears','ioMonths','vacancy','taxes','ins','utils','repairs','mgmtPct','hoa','units','sqft','targetDSCR','targetCoC','targetLTV'].includes(e.target.id)){
          analyze();
        }
      }));
    }
    document.getElementById('btnRun').addEventListener('click', analyze);
    document.getElementById('btnSave').addEventListener('click', saveInputs);
    document.getElementById('btnReset').addEventListener('click', ()=>{ localStorage.removeItem('kapi.prestige.inputs'); location.reload(); });
    init();
  </script>

<script src="https://cdn.auth0.com/js/auth0-spa-js/2.5/auth0-spa-js.production.js"></script>
<script src="/auth0-config.js"></script>
<script src="/auth0-client.js"></script>

</body>
</html>
