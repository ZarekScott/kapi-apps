<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Account â€” Kapi</title>
  <link rel="stylesheet" href="assets/css/brand.css">
  <script src="assets/js/theme.js" defer></script>

  <style>
    :root{--bg:#0b1220;--panel:#0f172a;--border:#1f2a44;--text:#e5e7eb;--muted:#94a3b8;--accent:#16a34a;--link:#7dd3fc}
    body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .header .inner{max-width:1100px;margin:0 auto;padding:14px 16px;display:flex;align-items:center;justify-content:space-between}
    .logo{font-weight:900;letter-spacing:.4px}
    .kapi-container{max-width:1100px;margin:0 auto;padding:0 16px}
    .card{border:1px solid var(--border);background:var(--panel);border-radius:16px;padding:24px}
    .center{display:grid;place-items:center;min-height:72vh}
    .title{margin:0 0 8px 0;font-size:28px}
    .sub{color:var(--muted);margin-top:0}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .field{display:grid;gap:6px;margin-top:10px}
    label{font-size:12px;color:var(--muted)}
    input[type=email],input[type=password],input[type=text]{padding:12px;border-radius:12px;border:1px solid var(--border);background:transparent;color:inherit}
    .hint{font-size:12px;color:var(--muted)}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;border:1px solid var(--border);background:transparent;color:#fff;font-weight:700;cursor:pointer}
    .btn.primary{background:var(--accent);border-color:transparent}
    a{color:var(--link);text-decoration:none}
    .danger{color:#fecaca}
    .ok{color:#bbf7d0}
    .msg{margin-top:10px;font-size:14px}
    .switch{display:flex;align-items:center;gap:8px;margin-top:10px}
  </style>

</head>
<body>
  <header class="header">
    <div class="inner">
      <div class="logo">Kapi</div>
      <nav class="nav"><a href="/apps.html" style="color:var(--link)">Apps</a></nav>
      <div class="actions">
        <button class="btn" onclick="toggleTheme()"><span id="themeLabel">ðŸŒ™</span></button>
      </div>
    </div>
  </header>

  <main class="kapi-container" style="padding:24px 0 40px">
    <div class="card" style="max-width:860px;margin:0 auto">
      <h1 class="title" style="margin-bottom:4px">Your account</h1>
      <p class="sub" id="who">Loadingâ€¦</p>

      <section style="margin-top:18px">
        <h3 style="margin:0 0 8px 0">Profile</h3>
        <form id="profileForm" class="row" style="align-items:flex-end">
          <div class="field" style="min-width:260px">
            <label for="fullName">Full name</label>
            <input id="fullName" type="text" placeholder="Your name">
          </div>
          <button class="btn primary" type="submit">Save</button>
        </form>
      </section>

      <hr style="margin:20px 0;border:0;border-top:1px solid var(--border)">

      <section>
        <h3 style="margin:0 0 8px 0">Change password</h3>
        <form id="passForm" class="row" style="align-items:flex-end">
          <div class="field" style="min-width:260px">
            <label for="newPass">New password</label>
            <input id="newPass" type="password" placeholder="New password">
          </div>
          <button class="btn primary" type="submit">Update</button>
        </form>
      </section>

      <hr style="margin:20px 0;border:0;border-top:1px solid var(--border)">

      <div class="row">
        <button id="logoutBtn" class="btn">Sign out</button>
      </div>

      <div id="msg" class="msg" style="margin-top:10px"></div>
    </div>
  </main>

  
  <script>
    const IDENTITY_URL = (window.
    const auth = new 
  </script>

  <script>
    const msg = document.getElementById('msg');
    function setMsg(text, ok=false){ msg.textContent = text; msg.className = 'msg ' + (ok ? 'ok' : 'danger'); }
    async function requireUser() {
      try {
        const user = await auth.currentUser();
        if (!user) throw new Error('Not signed in');
        return user;
      } catch {
        window.location.href = '/login.html';
      }
    }
    document.addEventListener('DOMContentLoaded', async () => {
      const user = await requireUser();
      if (!user) return;
      document.getElementById('who').textContent = `Signed in as ${user.email}`;
      document.getElementById('fullName').value = (user.user_metadata && user.user_metadata.fullName) || '';
      document.getElementById('profileForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        try {
          const fullName = document.getElementById('fullName').value;
          await user.update({ data: { fullName } });
          setMsg('Profile updated', true);
        } catch (err) {
          setMsg(err && err.message ? err.message : 'Could not update profile');
        }
      });
      document.getElementById('passForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        try {
          const newPass = document.getElementById('newPass').value;
          if (!newPass) return setMsg('Enter a new password');
          await user.update({ password: newPass });
          setMsg('Password updated', true);
        } catch (err) {
          setMsg(err && err.message ? err.message : 'Could not update password');
        }
      });
      document.getElementById('logoutBtn').addEventListener('click', async () => {
        try {
          await auth.logout();
          window.location.href = '/login.html';
        } catch (err) {
          setMsg('Could not log out');
        }
      });
    });
  </script>
<script>
  document.addEventListener('DOMContentLoaded', async () => {
    // Redirects to login if not authenticated
    await kapiRequireAuth("signup.html");

    // Optional: show whoâ€™s logged in
    try {
      const user = await kapiAuth.getUser();
      console.log('Logged in as:', user?.email || user?.name || user?.sub);
      // Example: put email in header
      const nav = document.querySelector('.nav a[href="/apps.html"]');
      if (nav && user?.email) nav.textContent = user.email.split('@')[0] + ' Â· Account';
    } catch (e) { /* ignore */ }

    // Example: call a secured Netlify Function with Bearer token
    // const token = await kapiAuth.getToken();
    // const res = await fetch('/.netlify/functions/entitlements', {
    //   headers: { Authorization: `Bearer ${token}` }
    // });
    // const data = await res.json();
    // console.log('Entitlements:', data);
  });
</script>
<!-- 1) Auth0 SPA SDK -->
<script src="https://cdn.auth0.com/js/auth0-spa-js/2.5/auth0-spa-js.production.js"></script>

<!-- 2) Your config (file or inline) -->
<script src="/auth0-config.js"></script>
<!-- or -->
<!-- <script>window.AUTH0_CONFIG={...}</script> -->

<!-- 3) Client bootstrap (provides kapiAuth + kapiRequireAuth) -->
<script src="/auth0-client.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', async () => {
    // Redirects to login if not authenticated
    await kapiRequireAuth("signup.html");

    // Optional: show whoâ€™s logged in
    try {
      const user = await kapiAuth.getUser();
      console.log('Logged in as:', user?.email || user?.name || user?.sub);
      // Example: put email in header
      const nav = document.querySelector('.nav a[href="/apps.html"]');
      if (nav && user?.email) nav.textContent = user.email.split('@')[0] + ' Â· Account';
    } catch (e) { /* ignore */ }

    // Example: call a secured Netlify Function with Bearer token
    // const token = await kapiAuth.getToken();
    // const res = await fetch('/.netlify/functions/entitlements', {
    //   headers: { Authorization: `Bearer ${token}` }
    // });
    // const data = await res.json();
    // console.log('Entitlements:', data);
  });

</script>
<!-- 1) Auth0 SPA SDK -->
<script src="https://cdn.auth0.com/js/auth0-spa-js/2.5/auth0-spa-js.production.js"></script>

<!-- 2) Your config (the file you just created at the root) -->
<script src="/auth0-config.js"></script>

<!-- 3) Client bootstrap (kapiAuth + kapiRequireAuth) -->
<script src="/auth0-client.js"></script>


<script>kapiRequireAuth('/login.html');</script>

<script>
(async function(){
  try {
    const u = await kapiAuth.getUser();
    var el = document.getElementById('who');
    if (el) el.textContent = (u && u.email) ? `Signed in as ${u.email}` : 'Signed in';
  } catch(e){}
})();
</script>

<script>
document.getElementById('logoutBtn')?.addEventListener('click', async (e)=>{
  e.preventDefault();
  await kapiAuth.logout();
});
</script>

</body>
</html>
